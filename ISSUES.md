# プロジェクトの問題点 (Project Issues)

このファイルは、`HmAnthropicClaudeWeb` プロジェクトの現在の実装における主要な問題点をまとめたものです。

---

## 1. 脆弱なUIオートメーション (Fragile UI Automation)

このプロジェクトの中核的なロジックは、キーボード入力をシミュレートする `keybd_event` APIと、ハードコードされた遅延 (`Task.Delay`) に依存しています。

- **UI変更への弱さ**: Anthropic ClaudeのWebサイトのUIデザイン、レイアウト、またはキーボードショートカットが少しでも変更されると、このツールは正常に動作しなくなる可能性が非常に高いです。
- **タイミングの問題**: `Task.Delay` による待機は、PCの負荷やネットワークの速度によって挙動が不安定になります。ウェブサイトの応答が遅い場合、キー入力が適切なタイミングで実行されず、処理が失敗する可能性があります。
- **フォーカスの問題**: キー入力シミュレーションは、アクティブなウィンドウがブラウザであることを前提としていますが、これを保証する仕組みがありません。

**提案**: 可能であれば、公式APIの利用を検討すべきです。それが難しい場合でも、より堅牢なUIオートメーションライブラリ（例：Selenium, Playwright）の導入が望ましいです。

---

## 2. クリップボード処理のバグ (Bug in Clipboard Handling)

`CaptureForBrowserPane` メソッドは、処理の開始時に `CaptureClipboard()` を呼び出して現在のクリップボードの内容をバックアップしますが、処理の終了時に `RestoreClipboard()` を呼び出していません。

- **影響**: このツールを実行すると、ユーザーが元々クリップボードにコピーしていた内容が失われてしまいます。これはユーザー体験を著しく損なう明確なバグです。

**提案**: `CaptureForBrowserPane` メソッドの `finally` ブロックなどで、必ず `RestoreClipboard()` が呼び出されるように修正すべきです。

---

## 3. コードの品質と一貫性の欠如 (Lack of Code Quality and Consistency)

コードベースには、可読性や保守性を低下させるいくつかの問題が見られます。

- **`async void` の使用**: `HmAnthropicClaudeWeb.cs` 内の `SendCtrlV` や `SendReturn` といったメソッドが `async void` として定義されています。これは「fire-and-forget」となり、呼び出し元で処理の完了を待機できないため、競合状態（レースコンディション）を引き起こす原因となります。
- **コメントと実装の不一致**: `Additional.cs` では、「スラッシュキー」(`VK_SLASH`) というコメントがあるにもかかわらず、実際には `VK_DOT`（ドット/ピリオドキー）が使用されています。これは混乱を招きます。

**提案**: `async void` はイベントハンドラなど特別な場合を除き、`async Task` に変更すべきです。また、コードとコメントの不一致は修正し、一貫性を保つべきです。

---

## 4. メンテナンス性とビルドの問題 (Maintainability and Build Issues)

`README.md` に記載されている通り、このツールが依存する `ClipboardHistMngr.exe` と `HmFocusEachBrowserInputField.exe` のソースコードは、別のGitHubリポジトリで管理されています。

- **ビルドの複雑さ**: プロジェクト全体をビルドするには、3つの異なるリポジトリを手動でクローンし、それぞれをビルドする必要があります。これは非常に手間がかかり、新規のコントリビューターにとって大きな障壁となります。
- **バージョン管理の問題**: 依存関係のバージョンを固定する仕組みがないため、依存先のリポジトリが更新された場合に互換性が失われるリスクがあります。

**提案**: Git submodules や単一のモノレポ構成に移行し、単一のコマンドでプロジェクト全体をビルドできるようにすることが強く推奨されます。

---

## 5. 不十分なエラー処理 (Insufficient Error Handling)

現在の実装では、UIオートメーションが成功したかどうかを検証する仕組みがありません。

- **失敗の検知不可**: 例えば、`Ctrl+V` での貼り付けが何らかの理由で失敗しても、プログラムはそれを検知できず、処理を続行してしまいます。
- **例外の隠蔽**: `ClipBoard.cs` の `CaptureClipboard` メソッド内など、一部の `catch` ブロックが空になっており、例外が発生してもそれが無視されます。これにより、問題の発見が遅れる可能性があります。

**提案**: UIオートメーションの各ステップで、期待した結果が得られたか（例：特定のUI要素が表示されたか）を確認する処理を追加すべきです。また、空の `catch` ブロックを避け、少なくともログにはエラーを記録するように修正すべきです。
